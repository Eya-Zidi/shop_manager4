<app-header-directeur></app-header-directeur>

<div class="background">
  <div class="row overlay">
    <div class="col-12 login-box">
      <h2>Demandes avec le même numéro : {{ num }}</h2>

      <!-- Section générale -->
      <div *ngIf="devisList.length > 0">
        <table class="table table-bordered">

          <tr><th>Matricule</th><td>{{ devisList[0].mtricule }}</td></tr>
          <tr><th>Nom</th><td>{{ devisList[0].name }}</td></tr>
          <tr><th>Prenom</th><td>{{ devisList[0].lastName }}</td></tr>
          <tr><th>Tel</th><td>{{ devisList[0].tel}}</td></tr>
          <tr><th>Email</th><td>{{ devisList[0].email }}</td></tr>

        </table>
      </div>
      <br><br><br>

      <!-- Section par devis avec clic pour sélectionner -->
      <div *ngFor="let devis of devisList; let i = index"
           class="devis-card" 
           [class.selected]="devis === selectedDevis" 
           (click)="selectedDevis = devis" 
           style="cursor:pointer;">
        <p>
          devis {{i+1}}
        </p>
        <button (click)="exportPDF(i)">Voir PDF</button>
      </div>

      <!-- Boutons Accept / Reject hors cards, activés seulement si devis sélectionné -->
      <div class="btn" *ngIf="selectedDevis" style="margin-top: 20px;">
        <p>Devis sélectionné : {{ selectedDevis.id }} - {{ selectedDevis.name }}</p>
        <a href="#" class="link" (click)="openAcceptPopup($event)">Accept</a>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
        <a href="#" class="link" (click)="openPopup($event)">Reject</a>
      </div>

      <!-- POPUP REFUS -->
      <div class="popup" *ngIf="showRejectPopup">
        <div class="popup-content">
          <h4>Motif du refus</h4>
          <textarea [(ngModel)]="reason" placeholder="Justification..."></textarea>
          <div class="popup-buttons">
            <button (click)="confirmReject()">Confirmer</button>
            <button (click)="closePopup()">Annuler</button>
          </div>
        </div>
      </div>

      

    </div>
  </div>
</div>

<app-footer></app-footer>
